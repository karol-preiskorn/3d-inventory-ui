<div class="container-fluid">
  <h2><i class="bi bi-bar-chart"></i> Edit Attribute</h2>
  <div>{{ editAttributeForm.controls._id.value | json }}</div>
  <form [formGroup]="editAttributeForm" (ngSubmit)="submitForm()" class="needs-validation" novalidate>
    <div class="row">
      <div class="col">
        <div class="form-group mb-3">
          <label for="deviceId" class="form-label">Device Id</label>
          <select (change)="changeDeviceId($event)" formControlName="deviceId" [ngClass]="{
                        'is-invalid': editAttributeForm.get('deviceId')?.invalid && (editAttributeForm.get('deviceId')?.touched || editAttributeForm.get('deviceId')?.dirty),
              'is-valid': editAttributeForm.get('deviceId')?.valid && !editAttributeForm.get('deviceId')?.hasError('atLeastOneValidator') && (editAttributeForm.get('deviceId')?.touched || editAttributeForm.get('deviceId')?.dirty),
                        'form-select': true,
                      }" id="deviceId">
            @for (deviceObj of deviceDictionary; track deviceObj; let i = $index) {
              <option [value]="deviceObj._id">
                {{ deviceObj.name }}
              </option>
            }
          </select>
          @if (editAttributeForm.hasError('atLeastOneValidator')) {
            <div class="error-message">
              One of field: deviceId, modelId or connectionId is required
            </div>
          }
          <div class="log-message">
            {{ editAttributeForm.controls.deviceId.value | json }}
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group mb-2">
          <label for="modelId" class="form-label">Model Id</label>
          <select (change)="changeModelId($event)" formControlName="modelId" [ngClass]="{
                        'is-invalid': editAttributeForm.get('modelId')?.invalid && (editAttributeForm.get('modelId')?.touched || editAttributeForm.get('modelId')?.dirty),
                        'is-valid': editAttributeForm.get('modelId')?.valid && (editAttributeForm.get('modelId')?.touched || editAttributeForm.get('modelId')?.dirty),
                        'form-select': true,
                      }" id="modelId">
            @for (modelObj of modelDictionary; track modelObj; let i = $index) {
              <option [value]="modelObj._id">
                {{ modelObj.name }}
              </option>
            }
          </select>
          @if (editAttributeForm.hasError('atLeastOneValidator')) {
            <div class="error-message">
              One of field: deviceId, modelId or connectionId is required
            </div>
          }
          <div class="log-message">
            {{ editAttributeForm.controls.modelId.value | json }}
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group mb-2">
          <label for="connectionId" class="form-label">Connection Id</label>
          <select (change)="changeConnectionId($event)" formControlName="connectionId" [ngClass]="{
                        'is-invalid': editAttributeForm.get('connectionId')?.invalid && (editAttributeForm.get('connectionId')?.touched || editAttributeForm.get('connectionId')?.dirty),
              'is-valid': editAttributeForm.get('connectionId')?.valid && !editAttributeForm.get('connectionId')?.hasError('atLeastOneValidator') && (editAttributeForm.get('connectionId')?.touched || editAttributeForm.get('connectionId')?.dirty),
                        'form-select': true,
                      }" id="connectionId">
            @for (connectionObj of connectionDictionary; track connectionObj; let i = $index) {
              <option
                value="{{ connectionObj._id }}">
                {{ connectionObj.name }}
              </option>
            }
          </select>
          @if (editAttributeForm.hasError('atLeastOneValidator')) {
            <div class="error-message">
              One of field: deviceId, modelId or connectionId is required
            </div>
          }
          <div class="log-message">
            {{ toString(editAttributeForm.controls.connectionId.value) }}
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group mb-2">
          <label for="attributeDictionaryId" class="form-label">Attribute Dictionary Id</label>
          <select formControlName="attributeDictionaryId" [ngClass]="{
              'is-invalid': editAttributeForm.get('attributeDictionaryId')?.invalid && (editAttributeForm.get('attributeDictionaryId')?.touched || editAttributeForm.get('attributeDictionaryId')?.dirty),
              'is-valid': editAttributeForm.get('attributeDictionaryId')?.valid && (editAttributeForm.get('attributeDictionaryId')?.touched || editAttributeForm.get('attributeDictionaryId')?.dirty),
              'form-select': true,
            }" id="attributeDictionaryId">
            @for (attributeDictionaryObj of attributeDictionary; track attributeDictionaryObj; let i = $index) {
              <option
                [value]="attributeDictionaryObj._id">
                {{ attributeDictionaryObj.name }}
              </option>
            }
          </select>
          @if (editAttributeForm.get('attributeDictionaryId')?.invalid && (editAttributeForm.get('attributeDictionaryId')?.touched || editAttributeForm.get('attributeDictionaryId')?.dirty)) {
            <div
              class="invalid-feedback">
              @if (editAttributeForm.get('attributeDictionaryId')?.errors?.required) {
                <div>
                  attributeDictionaryId is required
                </div>
              }
            </div>
          }
          <div class="log-message">
            {{ editAttributeForm.controls.attributeDictionaryId.value }}
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div class="form-group mb-2">
          <label for="value" class="form-label">Value</label>
          <input type="text" formControlName="value" id="value" required [ngClass]="{
              'is-invalid': editAttributeForm.get('value')?.status !== 'VALID',
              'is-valid': editAttributeForm.controls.value.status === 'VALID',
              'form-control': true,
            }" />
          @if (editAttributeForm.controls.value.errors) {
            <div class="invalid-feedback">
              @if (editAttributeForm.controls.value.errors.required) {
                <div>Value is required</div>
              }
              @if (editAttributeForm.controls.value.errors.minlength) {
                <div>
                  Value must be at least {{ editAttributeForm.controls.value.errors.minlength.requiredLength }}
                  characters
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div class="form-group mb-3">
          <button type="submit" [disabled]="!(editAttributeForm.valid && editAttributeForm.touched)"
            class="btn btn-primary">
            Update attribute
          </button>
          <!-- <div *ngIf="!(this.editAttributeForm.valid && this.editAttributeForm.touched)" class="invalid-feedback">
          Form is invalid
        </div>
        <div class="log-message">atLeastOneValidator: {{ editAttributeForm.hasError('atLeastOneValidator') }}</div>
        <div class="log-message">editAttributeForm.value: {{ toString(editAttributeForm.value) }}</div>
        <div class="log-message">this.editAttributeForm.valid: {{ toString(this.editAttributeForm.valid) }}</div>
        <div class="log-message">this.editAttributeForm.touched: {{ toString(this.editAttributeForm.touched) }}</div> -->
      </div>
    </div>
  </div>
</form>
</div>
<!-- The <app-log> component is used to display logs or debugging information related to the current component.
It shows the state of the component, including form values, validation statuses, and any errors encountered.
This helps developers understand the current state of the application and troubleshoot issues effectively. -->
<app-log [component]="component"></app-log>
