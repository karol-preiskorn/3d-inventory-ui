<div class="container-fluid">
  <h3><i class="bi bi-building"></i> Add Floor</h3>
  <form [formGroup]="floorForm" (ngSubmit)="onSubmit()" class="g-3 needs-validation" novalidate>
    <div class="col border">
      <div class="form-group mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" id="name" formControlName="name" minlength="4" maxlength="4000" required [ngClass]="{
        'form-control': true,
        'is-invalid': floorForm.get('name')?.invalid && (floorForm.get('name')?.touched || floorForm.get('name')?.dirty),
        'is-valid': floorForm.get('name')?.valid && (floorForm.get('name')?.touched || floorForm.get('name')?.dirty)
          }" [attr.aria-invalid]="floorForm.get('name')?.invalid ? true : null"
          [attr.aria-describedby]="'name-error'" />
        @if (floorForm.get('name')?.errors && (floorForm.get('name')?.touched || floorForm.get('name')?.dirty)) {
          <div
            class="invalid-feedback" id="name-error">
            @if (floorForm.get('name')?.errors; as errors) {
              @if (errors.required) {
                <div>Name is required</div>
              }
              @if (errors.minlength) {
                <div>
                  Name must be at least {{ errors.minlength.requiredLength }} characters
                </div>
              }
              @if (errors.maxlength) {
                <div>
                  Name cannot exceed {{ errors.maxlength.requiredLength }} characters
                </div>
              }
              @if (errors.pattern) {
                <div>
                  Name contains invalid characters
                </div>
              }
              @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
                <div>
                  Invalid value for Name
                </div>
              }
            }
          </div>
        }
      </div>
      <div formGroupName="address">
        <div class="row">
          <div class="col">
            <div class="form-group mb-3">
              <label for="street" class="form-label">Street</label>
              <input type="text" id="street" formControlName="street" required minlength="1" [ngClass]="{
                  'form-control': true,
                  'is-invalid': floorForm.get('address.street')?.invalid && (floorForm.get('address.street')?.touched || floorForm.get('address.street')?.dirty),
                  'is-valid': floorForm.get('address.street')?.valid && (floorForm.get('address.street')?.touched || floorForm.get('address.street')?.dirty)
                }" [attr.aria-invalid]="floorForm.get('address.street')?.invalid ? true : null"
                [attr.aria-describedby]="'street-error'" />
              @if (floorForm.get('address.street')?.errors && (floorForm.get('address.street')?.touched || floorForm.get('address.street')?.dirty)) {
                <div
                  class="invalid-feedback" id="street-error">
                  @if (floorForm.get('address.street')?.errors; as errors) {
                    @if (errors.required) {
                      <div>Street is required</div>
                    }
                    @if (errors.minlength) {
                      <div>
                        Street must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
                        <span
                        >s</span>
                      }
                    </div>
                  }
                  @if (errors.maxlength) {
                    <div>
                      Street cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
                      <span
                      >s</span>
                    }
                  </div>
                }
                @if (errors.pattern) {
                  <div>
                    Street contains invalid characters
                  </div>
                }
                @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
                  <div>
                    Invalid value for Street
                  </div>
                }
              }
            </div>
          }
        </div>
      </div>
      <div class="col">
        <div class="form-group mb-3">
          <label for="city" class="form-label">City</label>
              <input type="text" id="city" formControlName="city" required minlength="1" [ngClass]="{
                  'form-control': true,
                  'is-invalid': floorForm.get('address.city')?.invalid && (floorForm.get('address.city')?.touched || floorForm.get('address.city')?.dirty),
                  'is-valid': floorForm.get('address.city')?.valid && (floorForm.get('address.city')?.touched || floorForm.get('address.city')?.dirty)
                }" [attr.aria-invalid]="floorForm.get('address.city')?.invalid ? true : null"
            [attr.aria-describedby]="'city-error'" />
          @if (floorForm.get('address.city')?.errors && (floorForm.get('address.city')?.touched || floorForm.get('address.city')?.dirty)) {
            <div
              class="invalid-feedback" id="city-error">
              @if (floorForm.get('address.city')?.errors; as errors) {
                @if (errors.required) {
                  <div>City is required</div>
                }
                @if (errors.minlength) {
                  <div>
                    City must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
                    <span
                    >s</span>
                  }
                </div>
              }
              @if (errors.maxlength) {
                <div>
                  City cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
                  <span
                  >s</span>
                }
              </div>
            }
            @if (errors.pattern) {
              <div>
                City contains invalid characters
              </div>
            }
            @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
              <div>
                Invalid value for City
              </div>
            }
          }
        </div>
      }
    </div>
  </div>
  <div class="col">
    <div class="form-group mb-3">
      <label for="country" class="form-label">Country</label>
              <input type="text" id="country" formControlName="country" required minlength="1" [ngClass]="{
                  'form-control': true,
                  'is-invalid': floorForm.get('address.country')?.invalid && (floorForm.get('address.country')?.touched || floorForm.get('address.country')?.dirty),
                  'is-valid': floorForm.get('address.country')?.valid && (floorForm.get('address.country')?.touched || floorForm.get('address.country')?.dirty)
                }" [attr.aria-invalid]="floorForm.get('address.country')?.invalid ? true : null"
        [attr.aria-describedby]="'country-error'" />
      @if (floorForm.get('address.country')?.errors && (floorForm.get('address.country')?.touched || floorForm.get('address.country')?.dirty)) {
        <div
          class="invalid-feedback" id="country-error">
          @if (floorForm.get('address.country')?.errors; as errors) {
            @if (errors.required) {
              <div>Country is required</div>
            }
            @if (errors.minlength) {
              <div>
                Country must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
                <span
                >s</span>
              }
            </div>
          }
          @if (errors.maxlength) {
            <div>
              Country cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
              <span
              >s</span>
            }
          </div>
        }
        @if (errors.pattern) {
          <div>
            Country contains invalid characters
          </div>
        }
        @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
          <div>
            Invalid value for Country
          </div>
        }
      }
    </div>
  }
</div>
</div>
<div class="col">
  <div class="form-group mb-3">
    <label for="postcode" class="form-label">Post code</label>
              <input type="text" id="postcode" formControlName="postcode" required minlength="1" [ngClass]="{
                  'form-control': true,
                  'is-invalid': floorForm.get('address.postcode')?.invalid && (floorForm.get('address.postcode')?.touched || floorForm.get('address.postcode')?.dirty),
                  'is-valid': floorForm.get('address.postcode')?.valid && (floorForm.get('address.postcode')?.touched || floorForm.get('address.postcode')?.dirty)
                }" [attr.aria-invalid]="floorForm.get('address.postcode')?.invalid ? true : null"
      [attr.aria-describedby]="'postcode-error'" />
    @if (floorForm.get('address.postcode')?.errors && (floorForm.get('address.postcode')?.touched || floorForm.get('address.postcode')?.dirty)) {
      <div
        class="invalid-feedback" id="postcode-error">
        @if (floorForm.get('address.postcode')?.errors; as errors) {
          @if (errors.required) {
            <div>Post code is required</div>
          }
          @if (errors.minlength) {
            <div>
              Post code must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
              <span
              >s</span>
            }
          </div>
        }
        @if (errors.maxlength) {
          <div>
            Post code cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
            <span
            >s</span>
          }
        </div>
      }
      @if (errors.pattern) {
        <div>
          Post code contains invalid characters
        </div>
      }
      @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
        <div>
          Invalid value for Post code
        </div>
      }
    }
  </div>
}
</div>
</div>
</div>
</div>
</div>

<h4>Add Dimensions</h4>

<div class="border">
  <div formArrayName="dimension">
    @for (dimensionForm of dimensionForms.controls; track dimensionForm; let i = $index) {
      <div>
        <div [formGroupName]="i">
          <div class="row">
            <div class="col">
              <div class="form-group mb-3">
                <label for="description-{{i}}" class="form-label">Description</label>
                <textarea id="description-{{i}}" formControlName="description" rows="2" minlength="4"
                    maxlength="4000" required [ngClass]="{
                      'form-control': true,
                      'is-invalid': getDimension(i, 'description')?.invalid && (getDimension(i, 'description')?.touched || getDimension(i, 'description')?.dirty),
                      'is-valid': getDimension(i, 'description')?.valid && (getDimension(i, 'description')?.touched || getDimension(i, 'description')?.dirty)
                    }"></textarea>
                @if (getDimension(i, 'description')?.errors && (getDimension(i, 'description')?.touched || getDimension(i, 'description')?.dirty)) {
                  <div
                    class="invalid-feedback">
                    @if (getDimension(i, 'description')?.errors?.required) {
                      <div>
                        Description is required
                      </div>
                    }
                    @if (getDimension(i, 'description')?.errors?.minlength) {
                      <div>
                        Description must be at least 4 characters
                      </div>
                    }
                    @if (getDimension(i, 'description')?.errors?.maxlength) {
                      <div>
                        Description cannot exceed 4000 characters
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-group mb-3">
                <label for="xPos-{{i}}" class="form-label">X position</label>
                  <input type="text" id="xPos-{{i}}" formControlName="xPos" required [ngClass]="{
                  'form-control': true,
                  'is-invalid': getDimension(i, 'xPos')?.invalid && (getDimension(i, 'xPos')?.touched || getDimension(i, 'xPos')?.dirty),
                  'is-valid': getDimension(i, 'xPos')?.valid && (getDimension(i, 'xPos')?.touched || getDimension(i, 'xPos')?.dirty)
                }" [attr.aria-invalid]="getDimension(i, 'xPos')?.invalid ? true : null"
                  [attr.aria-describedby]="'dimension-xPos-' + i + '-error'" />
                @if (getDimension(i, 'xPos')?.errors && (getDimension(i, 'xPos')?.touched || getDimension(i, 'xPos')?.dirty)) {
                  <div
                    class="invalid-feedback" [id]="'dimension-xPos-' + i + '-error'">
                    @if (getDimension(i, 'xPos')?.errors; as errors) {
                      @if (errors.required) {
                        <div>X position is required</div>
                      }
                      @if (errors.minlength) {
                        <div>
                          X position must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
                          <span
                          >s</span>
                        }
                      </div>
                    }
                    @if (errors.maxlength) {
                      <div>
                        X position cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
                        <span
                        >s</span>
                      }
                    </div>
                  }
                  @if (errors.pattern) {
                    <div>
                      X position must be a valid number
                    </div>
                  }
                  @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
                    <div>
                      Invalid value for X position
                    </div>
                  }
                }
              </div>
            }
          </div>
        </div>
        <div class="col">
          <div class="form-group mb-3">
            <label for="yPos-{{i}}" class="form-label">Y position</label>
                  <input type="text" id="yPos-{{i}}" formControlName="yPos" required [ngClass]="{
                      'form-control': true,
                      'is-invalid': getDimension(i, 'yPos')?.invalid && (getDimension(i, 'yPos')?.touched || getDimension(i, 'yPos')?.dirty),
                      'is-valid': getDimension(i, 'yPos')?.valid && (getDimension(i, 'yPos')?.touched || getDimension(i, 'yPos')?.dirty)
                    }" [attr.aria-invalid]="getDimension(i, 'yPos')?.invalid ? true : null"
              [attr.aria-describedby]="'dimension-yPos-' + i + '-error'" />
            @if (getDimension(i, 'yPos')?.errors && (getDimension(i, 'yPos')?.touched || getDimension(i, 'yPos')?.dirty)) {
              <div
                class="invalid-feedback" [id]="'dimension-yPos-' + i + '-error'">
                @if (getDimension(i, 'yPos')?.errors; as errors) {
                  @if (errors.required) {
                    <div>Y position is required</div>
                  }
                  @if (errors.minlength) {
                    <div>
                      Y position must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
                      <span
                      >s</span>
                    }
                  </div>
                }
                @if (errors.maxlength) {
                  <div>
                    Y position cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
                    <span
                    >s</span>
                  }
                </div>
              }
              @if (errors.pattern) {
                <div>
                  Y position must be a valid number
                </div>
              }
              @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
                <div>
                  Invalid value for Y position
                </div>
              }
            }
          </div>
        }
      </div>
    </div>
    <div class="col">
      <div class="form-group mb-3">
        <label for="hPos-{{i}}" class="form-label">H position</label>
                  <input type="text" id="hPos-{{i}}" formControlName="hPos" required [ngClass]="{
                      'form-control': true,
                      'is-invalid': getDimension(i, 'hPos')?.invalid && (getDimension(i, 'hPos')?.touched || getDimension(i, 'hPos')?.dirty),
                      'is-valid': getDimension(i, 'hPos')?.valid && (getDimension(i, 'hPos')?.touched || getDimension(i, 'hPos')?.dirty)
                    }" [attr.aria-invalid]="getDimension(i, 'hPos')?.invalid ? true : null"
          [attr.aria-describedby]="'dimension-hPos-' + i + '-error'" />
        @if (getDimension(i, 'hPos')?.errors && (getDimension(i, 'hPos')?.touched || getDimension(i, 'hPos')?.dirty)) {
          <div
            class="invalid-feedback" [id]="'dimension-hPos-' + i + '-error'">
            @if (getDimension(i, 'hPos')?.errors; as errors) {
              @if (errors.required) {
                <div>H position is required</div>
              }
              @if (errors.minlength) {
                <div>
                  H position must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
                  <span
                  >s</span>
                }
              </div>
            }
            @if (errors.maxlength) {
              <div>
                H position cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
                <span
                >s</span>
              }
            </div>
          }
          @if (errors.pattern) {
            <div>
              H position must be a valid number
            </div>
          }
          @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
            <div>
              Invalid value for H position
            </div>
          }
        }
      </div>
    }
  </div>
</div>
</div>
<div class="row">
  <div class="col">
    <div class="form-group mb-3">
      <label for="dimension-x-{{i}}" class="form-label">X</label>
                  <input type="text" id="dimension-x-{{i}}" formControlName="x" required [ngClass]="{
                      'form-control': true,
                      'is-invalid': getDimension(i, 'x')?.invalid && (getDimension(i, 'x')?.touched || getDimension(i, 'x')?.dirty),
                      'is-valid': getDimension(i, 'x')?.valid && (getDimension(i, 'x')?.touched || getDimension(i, 'x')?.dirty)
                    }" [attr.aria-invalid]="getDimension(i, 'x')?.invalid ? true : null"
        [attr.aria-describedby]="'dimension-x-' + i + '-error'" />
      @if (getDimension(i, 'x')?.errors && (getDimension(i, 'x')?.touched || getDimension(i, 'x')?.dirty)) {
        <div
          class="invalid-feedback" [id]="'dimension-x-' + i + '-error'">
          @if (getDimension(i, 'x')?.errors; as errors) {
            @if (errors.required) {
              <div>X is required</div>
            }
            @if (errors.minlength) {
              <div>
                X must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
                <span
                >s</span>
              }
            </div>
          }
          @if (errors.maxlength) {
            <div>
              X cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
              <span
              >s</span>
            }
          </div>
        }
        @if (errors.pattern) {
          <div>
            X must be a valid number
          </div>
        }
        @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
          <div>
            Invalid value for X
          </div>
        }
      }
    </div>
  }
</div>
</div>
<div class="col">
  <div class="form-group mb-3">
    <label for="dimension-y-{{i}}" class="form-label">Y</label>
                  <input type="text" id="dimension-y-{{i}}" formControlName="y" required [ngClass]="{
                      'form-control': true,
                      'is-invalid': getDimension(i, 'y')?.invalid && (getDimension(i, 'y')?.touched || getDimension(i, 'y')?.dirty),
                      'is-valid': getDimension(i, 'y')?.valid && (getDimension(i, 'y')?.touched || getDimension(i, 'y')?.dirty)
                    }" [attr.aria-invalid]="getDimension(i, 'y')?.invalid ? true : null"
      [attr.aria-describedby]="'dimension-y-' + i + '-error'" />
    @if (getDimension(i, 'y')?.errors && (getDimension(i, 'y')?.touched || getDimension(i, 'y')?.dirty)) {
      <div
        class="invalid-feedback" [id]="'dimension-y-' + i + '-error'">
        @if (getDimension(i, 'y')?.errors; as errors) {
          @if (errors.required) {
            <div>Y is required</div>
          }
          @if (errors.minlength) {
            <div>
              Y must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
              <span
              >s</span>
            }
          </div>
        }
        @if (errors.maxlength) {
          <div>
            Y cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
            <span
            >s</span>
          }
        </div>
      }
      @if (errors.pattern) {
        <div>
          Y must be a valid number
        </div>
      }
      @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
        <div>
          Invalid value for Y
        </div>
      }
    }
  </div>
}
</div>
</div>
<div class="col">
  <div class="form-group mb-3">
    <label for="dimension-h-{{i}}" class="form-label">H</label>
                  <input type="text" id="dimension-h-{{i}}" formControlName="h" required [ngClass]="{
                      'form-control': true,
                      'is-invalid': getDimension(i, 'h')?.invalid && (getDimension(i, 'h')?.touched || getDimension(i, 'h')?.dirty),
                      'is-valid': getDimension(i, 'h')?.valid && (getDimension(i, 'h')?.touched || getDimension(i, 'h')?.dirty)
                    }" [attr.aria-invalid]="getDimension(i, 'h')?.invalid ? true : null"
      [attr.aria-describedby]="'dimension-h-' + i + '-error'" />
    @if (getDimension(i, 'h')?.errors && (getDimension(i, 'h')?.touched || getDimension(i, 'h')?.dirty)) {
      <div
        class="invalid-feedback" [id]="'dimension-h-' + i + '-error'">
        @if (getDimension(i, 'h')?.errors; as errors) {
          @if (errors.required) {
            <div>H is required</div>
          }
          @if (errors.minlength) {
            <div>
              H must be at least {{ errors.minlength.requiredLength }} character@if (errors.minlength.requiredLength > 1) {
              <span
              >s</span>
            }
          </div>
        }
        @if (errors.maxlength) {
          <div>
            H cannot exceed {{ errors.maxlength.requiredLength }} character@if (errors.maxlength.requiredLength > 1) {
            <span
            >s</span>
          }
        </div>
      }
      @if (errors.pattern) {
        <div>
          H must be a valid number
        </div>
      }
      @if (!errors.required && !errors.minlength && !errors.maxlength && !errors.pattern) {
        <div>
          Invalid value for H
        </div>
      }
    }
  </div>
}
</div>
</div>
</div>
<div class="d-flex p-2">
  <div class="p-1 g-col-1">
    <button type="button" (click)="addDimension()" class="btn btn-success">
      <i class="bi bi-file-earmark-plus"></i> Add Dimension
    </button>
  </div>
  <div class="p-1 g-col-1 column-gap-3">
    <button type="button" (click)="deleteDimension(i)" class="btn btn-danger">
      <i class="bi bi-file-earmark-minus"></i> Delete Dimension
    </button>
  </div>
  <div class="p-1 g-col-1 column-gap-3">
    <button type="button" (click)="generateDimension(i)" class="btn brightness-20 btn-warning">
      <i class="bi bi-bookmark-plus"></i> Generate random Dimension no. {{ i }}
    </button>
  </div>
</div>
</div>
</div>
}
</div>
</div>
<div class="d-flex p-2 small bg-blend-color text-body-tertiary">
  <div class="p-2 g-col-2">
    Form Status: <code>{{ floorForm.status }}</code>
  </div>
  <div class="p-2 g-col-2">
    Form Values: <code>{{ toText(floorForm.value) }}</code>
  </div>
</div>

<div class="d-flex p-2">
  <div class="p-2 g-col-2">
    <button type="submit" [disabled]="isSubmitDisabled" class="btn btn-primary mb-3">
      <i class="bi bi-save"></i> Save
    </button>
  </div>
  <div class="p-2 g-col-2">
    <button type="button" (click)="generateFloor()" class="btn btn-warning mb-3">
      <i class="bi bi-file-earmark-plus"></i> Generate random floor
    </button>
  </div>
</div>
</form>
</div>
