<div class="container-fluid">
  <h2><i class="bi bi-ethernet"></i> Connections</h2>

  @if (isLoading) {
  <div class="alert alert-info" role="alert">
    <i class="bi bi-hourglass-split"></i>
    <strong>Loading:</strong> Fetching connections data...
  </div>
  }

  @if (error) {
  <div class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle"></i>
    <strong>Error:</strong> {{ error }}
  </div>
  }

  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Device From</th>
        <th scope="col">Device To</th>
      </tr>
    </thead>
    <tbody>
      @if (connectionList.length === 0 && !isLoading) {
      <tr>
        <td colspan="4" class="text-center">
          <div class="alert alert-info" role="alert">
            <i class="bi bi-info-circle"></i>
            No connections found. <a href="/add-connection" class="alert-link">Create your first connection</a>.
          </div>
        </td>
      </tr>
      }
      @for (
      connectionObj of connectionList
      | slice: (connectionListPage - 1) * pageSize : connectionListPage * pageSize
      ; track
      connectionObj) {
      <tr>
        <td>
          {{ connectionObj.name }}
          <div class="deviceid">{{ connectionObj._id }}</div>
        </td>
        <td>
          <a href="/edit-device/{{ connectionObj.deviceIdFrom }}">
            <i class="bi bi-box"></i> {{ this.findDevice(connectionObj.deviceIdFrom).name }}
          </a>
          <div class="deviceid">{{ connectionObj.deviceIdFrom }}</div>
        </td>
        <td>
          <a href="/edit-device/{{ connectionObj.deviceIdTo }}">
            <i class="bi bi-box"></i> {{ this.findDevice(connectionObj.deviceIdTo).name }}
          </a>
          <div class="deviceid">{{ connectionObj.deviceIdTo }}</div>
        </td>
        <td>
          <fieldset class="btn-group float-md-end" aria-label="connection-operations">
            <button type="button" class="btn btn-success btn-sm move-right" id="edit-connection"
              (click)="editConnection(connectionObj)">
              <i class="bi bi-pen"></i>
            </button>
            <button type="button" id="delete-connection" class="btn btn-danger btn-sm"
              (click)="deleteConnection(connectionObj._id)">
              <i class="bi bi-trash"></i>
            </button>
            <button type="button" id="clone-connection" class="btn btn-info btn-sm"
              (click)="cloneConnection(connectionObj._id)">
              <i class="bi bi-copy"></i>
            </button>
          </fieldset>
        </td>
      </tr>
      }
    </tbody>
  </table>
  <button type="button" class="btn btn-success btn-sm move-right mb-3 me-2" (click)="AddForm()">
    <i class="bi bi-plus-lg"></i> Add
  </button>
  <button type="button" class="btn btn-secondary btn-sm mb-3 me-2" (click)="debugConnectionAPI()">
    <i class="bi bi-bug"></i> Debug API
  </button>
  <button type="button" class="btn btn-info btn-sm mb-3" (click)="loadConnection()">
    <i class="bi bi-arrow-clockwise"></i> Refresh
  </button>
  <ngb-pagination class="float-end me-2" [(page)]="connectionListPage" [pageSize]="pageSize"
    [collectionSize]="connectionList.length" [maxSize]="5" [boundaryLinks]="true"
    aria-label="Connection pagination"></ngb-pagination>
</div>

<app-log [component]="component" [componentName]="componentName" [isComponent]="true"></app-log>
