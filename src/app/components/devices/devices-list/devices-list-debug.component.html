<div class="container-fluid">
  <h3><i class="bi bi-hdd"></i> Devices [{{deviceList.length}} devices] üêõ Debug Mode</h3>

  <!-- Debug Information -->
  <div class="alert alert-info">
    <strong>üîç Debug Info:</strong><br>
    Device List Length: {{ deviceList.length }}<br>
    Model List Length: {{ modelList.length }}<br>
    Current Page: {{ deviceListPage }}<br>
    Items per page: 5
  </div>

  @if (deviceList.length === 0) {
  <div class="alert alert-warning">
    <strong>‚ö†Ô∏è No devices found!</strong><br>
    This could indicate an API loading issue or empty response.
  </div>
  }

  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Position</th>
        <th scope="col">Model</th>
        <th scope="col">Debug Info</th>
      </tr>
    </thead>
    <tbody>
      @for (device of deviceList | slice: (deviceListPage - 1) * 5 : deviceListPage * 5; track device._id) {
      <tr>
        <td>
          <a title="{{ device._id }}">{{ device.name }}</a>
          <p class="fs-7 fw-lighter deviceid">{{ device._id }}</p>
        </td>
        <td>({{ device.position.x }}, {{ device.position.y }}, {{ device.position.h }})</td>
        <td>
          <a title="{{ device.modelId }}" href="edit-model/{{ device.modelId }}"><i class="bi bi-motherboard"></i>
            {{ device.modelId === null ? 'is null' : FindModelName(device.modelId) }}</a>
          <p class="fs-7 fw-lighter deviceid">{{ device.modelId }}</p>
        </td>
        <td>
          <small class="text-muted">
            Type: {{ typeof device }}<br>
            Keys: {{ Object.keys(device).join(', ') }}<br>
            Attrs: {{ device.attributes?.length || 0 }}
          </small>
        </td>
        <td>
          <fieldset class="btn-group float-md-end" aria-label="device-operations">
            <button type="button" class="btn btn-success btn-sm move-right" id="edit-device"
              (click)="EditForm(device)">
              <i class="bi bi-pen"></i>
            </button>
            <button type="button" id="delete-device" class="btn btn-danger btn-sm"
              (click)="DeleteDevice(device._id)">
              <i class="bi bi-trash"></i>
            </button>
            <button type="button" id="clone-device" class="btn btn-light btn-sm" (click)="CloneDevice(device._id)">
              <i class="bi bi-copy"></i>
            </button>
          </fieldset>
        </td>
      </tr>
      } @empty {
      <tr>
        <td colspan="5" class="text-center text-muted">
          <strong>üîç No devices to display</strong><br>
          Current slice: {{ (deviceListPage - 1) * 5 }} to {{ deviceListPage * 5 }}<br>
          Total devices: {{ deviceList.length }}
        </td>
      </tr>
      }
    </tbody>
  </table>

  <button type="button" class="btn btn-success btn-sm move-right mb-3" (click)="AddForm()">
    <i class="bi bi-plus-lg"></i> Add
  </button>

  <button type="button" class="btn btn-info btn-sm mb-3 ms-2" (click)="loadDevices()">
    <i class="bi bi-arrow-clockwise"></i> Reload Devices
  </button>

  <button type="button" class="btn btn-secondary btn-sm mb-3 ms-2" (click)="loadModels()">
    <i class="bi bi-arrow-clockwise"></i> Reload Models
  </button>

  <ngb-pagination class="float-end me-2" [(page)]="deviceListPage" [pageSize]="5"
    [collectionSize]="deviceList.length" [boundaryLinks]="true" aria-label="Attribute pagination">
  </ngb-pagination>
</div>

<app-log [component]="component" [componentName]="componentName" [isComponent]="true"></app-log>

<!-- Raw Device Data Debug -->
<div class="container-fluid mt-4">
  <details class="border p-3">
    <summary><strong>üîß Raw Device Data (First 3 devices)</strong></summary>
    <pre class="bg-light p-2 mt-2"><code>{{ stringify(deviceList.slice(0, 3)) }}</code></pre>
  </details>
</div>
