#!/usr/bin/bash
# File:        /.husky/commit-msg
# Description: Validate commit message format
# 2025-11-14   Created    Conventional commit enforcement for Angular UI

. "$(dirname "$0")/_/husky.sh"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}üìù Validating commit message format...${NC}"

# Read commit message
COMMIT_MSG=$(cat "$1")

# Conventional commit pattern
# Format: type(scope): description
# Examples: feat: add login, fix(auth): resolve token issue
CONVENTIONAL_PATTERN="^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\(.+\))?: .{1,}"

if echo "$COMMIT_MSG" | grep -qE "$CONVENTIONAL_PATTERN"; then
  echo -e "${GREEN}‚úÖ Commit message format is valid${NC}"
  exit 0
fi

# Check for merge commits (allow them)
if echo "$COMMIT_MSG" | grep -qE "^Merge"; then
  echo -e "${BLUE}‚ÑπÔ∏è  Merge commit detected (allowed)${NC}"
  exit 0
fi

# Check for revert commits (allow them)
if echo "$COMMIT_MSG" | grep -qE "^Revert"; then
  echo -e "${BLUE}‚ÑπÔ∏è  Revert commit detected (allowed)${NC}"
  exit 0
fi

# Commit message doesn't match conventional format
echo -e "${RED}‚ùå Commit message does not follow conventional format!${NC}"
echo -e ""
echo -e "${YELLOW}Current message:${NC}"
echo -e "  ${COMMIT_MSG}"
echo -e ""
echo -e "${BLUE}Expected format:${NC} type(scope): description"
echo -e ""
echo -e "${BLUE}Valid types:${NC}"
echo -e "  ${GREEN}feat${NC}     - New feature"
echo -e "  ${GREEN}fix${NC}      - Bug fix"
echo -e "  ${GREEN}docs${NC}     - Documentation changes"
echo -e "  ${GREEN}style${NC}    - Code style changes (formatting, etc.)"
echo -e "  ${GREEN}refactor${NC} - Code refactoring"
echo -e "  ${GREEN}perf${NC}     - Performance improvements"
echo -e "  ${GREEN}test${NC}     - Adding or updating tests"
echo -e "  ${GREEN}chore${NC}    - Maintenance tasks"
echo -e "  ${GREEN}build${NC}    - Build system changes"
echo -e "  ${GREEN}ci${NC}       - CI/CD changes"
echo -e "  ${GREEN}revert${NC}   - Revert previous commit"
echo -e ""
echo -e "${BLUE}Examples:${NC}"
echo -e "  feat: add user authentication"
echo -e "  fix(auth): resolve token expiration issue"
echo -e "  docs: update README installation guide"
echo -e "  refactor(components): improve device list performance"
echo -e "  test(services): add authentication service tests"
echo -e ""
echo -e "${YELLOW}üí° Scope is optional but recommended${NC}"

exit 1
